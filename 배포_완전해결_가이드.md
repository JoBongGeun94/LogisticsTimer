# Vercel 배포 오류 완전 해결 가이드

## 문제 분석 (MECE)

### A. Git 동기화 문제
- Vercel이 구버전 커밋(1fdc8b0) 사용 중
- 수정된 vercel.json이 GitHub에 반영되지 않음

### B. Vercel 설정 문제  
- "Function Runtimes must have a valid version" 오류
- 복잡한 functions 블록이 원인

### C. 빌드 설정 문제
- outputDirectory 경로 불일치 가능성
- API 함수 감지 실패

## 완전 해결 방안

### 1단계: Git 강제 동기화
```bash
# 현재 브랜치 확인
git branch

# 모든 파일 강제 추가
git add -A

# 커밋 생성 (기존 커밋 덮어쓰기)
git commit -m "URGENT: Fix Vercel deployment with minimal config"

# 강제 푸시
git push origin main --force-with-lease

# 확인
git log --oneline -n 2
```

### 2단계: Vercel 설정 완전 초기화
```bash
# vercel.json 완전 삭제
rm vercel.json

# .vercelignore 생성
echo "node_modules
.git
.env*
.cache
dist" > .vercelignore

# 다시 커밋
git add .
git commit -m "Remove vercel.json for auto-detection"
git push origin main
```

### 3단계: 대안 배포 방법들

#### 방법 A: Vercel CLI 직접 배포
```bash
# Vercel CLI 설치
npm i -g vercel

# 로그인
vercel login

# 직접 배포
vercel --prod
```

#### 방법 B: GitHub Actions 배포
```yaml
# .github/workflows/deploy.yml 생성
name: Deploy to Vercel
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install
      - run: npm run build
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
          vercel-args: '--prod'
```

#### 방법 C: Netlify 대안 배포
```toml
# netlify.toml 생성
[build]
  command = "npm run build"
  publish = "dist"

[functions]
  directory = "api"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### 4단계: 환경 변수 완전 설정

#### Vercel 대시보드에서:
```
DATABASE_URL = postgresql://[Neon 연결 문자열]
JWT_SECRET = [32자 이상 보안키]
SESSION_SECRET = [세션 보안키]
REPLIT_DOMAINS = [앱이름].vercel.app
REPL_ID = [Replit ID]
NODE_ENV = production
```

#### 로컬 .env 파일:
```bash
# .env.production 생성
DATABASE_URL=postgresql://user:pass@host:5432/db
JWT_SECRET=your-super-secure-32-character-secret
SESSION_SECRET=your-session-secret-key
REPLIT_DOMAINS=your-app.vercel.app
REPL_ID=your-repl-id
NODE_ENV=production
```

### 5단계: 빌드 최적화

#### package.json 스크립트 수정:
```json
{
  "scripts": {
    "build": "npm run build:client && npm run build:api",
    "build:client": "vite build",
    "build:api": "mkdir -p dist/api && cp -r api dist/",
    "start": "node server/index.js",
    "vercel-build": "npm run build"
  }
}
```

### 6단계: 트러블슈팅 체크리스트

#### 배포 전 확인사항:
- [ ] GitHub에 최신 코드 푸시 완료
- [ ] vercel.json 파일 삭제됨
- [ ] 환경 변수 모두 설정됨
- [ ] 빌드 명령어 정상 작동
- [ ] API 엔드포인트 로컬 테스트 완료

#### 배포 후 확인사항:
- [ ] 빌드 로그에 오류 없음
- [ ] API 엔드포인트 응답 정상
- [ ] 정적 파일 로딩 정상
- [ ] 데이터베이스 연결 정상
- [ ] 인증 시스템 작동 정상

## 즉시 실행 순서

1. **vercel.json 완전 삭제**
2. **git add . && git commit && git push**
3. **Vercel 대시보드에서 Redeploy**
4. **환경 변수 재확인**
5. **배포 성공 검증**

이 가이드를 순서대로 실행하면 모든 배포 문제가 해결됩니다.