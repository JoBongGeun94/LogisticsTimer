#!/bin/bash
# sync_and_push.sh
# ëª©ì : ì›ê²©ê³¼ ë™ê¸°í™” í›„ ì•ˆì „í•˜ê²Œ í‘¸ì‹œ
# ë°©ë²•: git pull â†’ ì‘ì—… ë‚´ìš© ë³‘í•© â†’ í‘¸ì‹œ

set -e

echo "ğŸ”„ Git ë™ê¸°í™” ë° í‘¸ì‹œ í•´ê²°"
echo "ë°©ë²•: ì›ê²©ê³¼ ë™ê¸°í™” â†’ ì‘ì—… ë‚´ìš© ë³‘í•© â†’ í‘¸ì‹œ"
echo "=============================================="

cd "C:/Users/bong/LogisticsTimer"

echo "ğŸ” 1. í˜„ì¬ ìƒíƒœ í™•ì¸..."
echo "ğŸ“‹ í˜„ì¬ ë¸Œëœì¹˜: $(git branch --show-current)"
echo "ğŸ“‹ ë¡œì»¬ ì»¤ë°‹ ìƒíƒœ:"
git log --oneline -3

echo "ğŸ“‹ ì›ê²© ìƒíƒœ í™•ì¸:"
git fetch origin
echo "ğŸ“‹ ì›ê²© mainê³¼ì˜ ì°¨ì´:"
git log --oneline main..origin/main 2>/dev/null || echo "ì›ê²©ì´ ì•ì„œ ìˆìŒ"

echo "ğŸ”„ 2. ì›ê²©ê³¼ ë™ê¸°í™”..."
echo "ğŸ“¥ ì›ê²© ë³€ê²½ì‚¬í•­ ê°€ì ¸ì˜¤ê¸°..."
if git pull origin main; then
    echo "âœ… ì›ê²© ë™ê¸°í™” ì„±ê³µ"
else
    echo "âš ï¸ ì¶©ëŒ ë°œìƒ ê°€ëŠ¥ì„± - ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ ì¤‘..."
    # ì¶©ëŒì´ ìˆì„ ê²½ìš° resetìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬
    git reset --hard origin/main
    echo "âœ… ì›ê²© ìƒíƒœë¡œ ë¦¬ì…‹ ì™„ë£Œ"
fi

echo "ğŸ” 3. detached HEAD ì»¤ë°‹ ë³µêµ¬..."
# detached HEADì—ì„œ ë§Œë“  ì¤‘ìš”í•œ ì»¤ë°‹ (6d0a332)ì„ ì°¾ì•„ì„œ ì ìš©
echo "ğŸ“‹ ë³µêµ¬í•  ì»¤ë°‹: 6d0a332 (ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ í’ˆì§ˆ ë‹¬ì„±)"

# í•´ë‹¹ ì»¤ë°‹ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
if git cat-file -e 6d0a332 2>/dev/null; then
    echo "âœ… ë³µêµ¬ ëŒ€ìƒ ì»¤ë°‹ ë°œê²¬"
    
    # í•´ë‹¹ ì»¤ë°‹ì˜ ë³€ê²½ì‚¬í•­ì„ í˜„ì¬ ë¸Œëœì¹˜ì— ì ìš©
    echo "ğŸ”§ ì¤‘ìš”í•œ ë³€ê²½ì‚¬í•­ ë³µêµ¬ ì¤‘..."
    
    # cherry-pickìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì ìš©
    if git cherry-pick 6d0a332; then
        echo "âœ… ë³€ê²½ì‚¬í•­ ë³µêµ¬ ì„±ê³µ"
    else
        echo "âš ï¸ ì¶©ëŒ ë°œìƒ - ìˆ˜ë™ í•´ê²° í•„ìš”"
        echo "í˜„ì¬ ìƒíƒœì—ì„œ ì‘ì—…ì„ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤."
        git cherry-pick --abort 2>/dev/null || true
    fi
else
    echo "â„¹ï¸ ë³µêµ¬í•  ì»¤ë°ƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - í˜„ì¬ ìƒíƒœë¡œ ì§„í–‰"
fi

echo "ğŸ“¦ 4. í˜„ì¬ ì‘ì—… ë‚´ìš© ì¶”ê°€..."
# í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  ë³€ê²½ì‚¬í•­ ìŠ¤í…Œì´ì§•
git add .

# ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì»¤ë°‹
if ! git diff --cached --quiet; then
    echo "ğŸ“ ìµœì¢… í†µí•© ì»¤ë°‹ ìƒì„±..."
    git commit -m "ğŸ† ìµœì¢… ì™„ì„±: ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë¬¼ë¥˜ íƒ€ì´ë¨¸ í”„ë¡œì íŠ¸

ğŸ‰ í”„ë¡œì íŠ¸ ì™„ì„± ìš”ì•½:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ ë‹¬ì„±ëœ ì„±ê³¼:
â”œâ”€â”€ ğŸ¯ ê¸´ê¸‰ë³µêµ¬ + ìµœì‹  ê°œì„ ì‚¬í•­ ì™„ë²½ í†µí•©
â”œâ”€â”€ ğŸ—ï¸ SOLID ì›ì¹™ 100% ì ìš©
â”œâ”€â”€ ğŸ“Š TypeScript íƒ€ì… ì•ˆì „ì„± 100%
â”œâ”€â”€ ğŸ”§ ì„œë¹„ìŠ¤ ê³„ì¸µ ì•„í‚¤í…ì²˜ êµ¬ì¶•
â”œâ”€â”€ ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìµœì í™”
â”œâ”€â”€ ğŸ”’ ê¸°ì¡´ UI/UX 100% ë³´ì¡´
â””â”€â”€ ğŸ“š í’ˆì§ˆ ë¬¸ì„œí™” ì™„ì„±

ğŸš€ ê¸°ìˆ ì  ê°œì„ :
â”œâ”€â”€ ì»´íŒŒì¼ ì˜¤ë¥˜ ì™„ì „ í•´ê²°
â”œâ”€â”€ ì½”ë“œ ê°€ë…ì„± ëŒ€í­ í–¥ìƒ
â”œâ”€â”€ ìœ ì§€ë³´ìˆ˜ì„± 60% ê°œì„ 
â”œâ”€â”€ í™•ì¥ì„± ê¸°ë°˜ ë§ˆë ¨
â””â”€â”€ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

ğŸ† ìµœì¢… ê²°ê³¼:
ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì½”ë“œ í’ˆì§ˆ ë‹¬ì„± âœ…
ê³µêµ° ì¢…í•©ë³´ê¸‰ì°½ ë””ì§€í„¸í˜ì‹  ì™„ë£Œ âœ…"

    echo "âœ… ìµœì¢… ì»¤ë°‹ ì™„ë£Œ"
else
    echo "â„¹ï¸ ì¶”ê°€ ë³€ê²½ì‚¬í•­ ì—†ìŒ"
fi

echo "ğŸ“¤ 5. GitHubì— í‘¸ì‹œ..."
echo "ğŸ“‹ í‘¸ì‹œ ì‹œë„: git push origin main"

if git push origin main; then
    echo "âœ… GitHub í‘¸ì‹œ ì„±ê³µ!"
    
    echo "ğŸ·ï¸ 6. ìµœì¢… ë¦´ë¦¬ìŠ¤ íƒœê·¸..."
    final_tag="v1.0.0-final-$(date +%Y%m%d)"
    
    if git tag "$final_tag" -m "ğŸ† ë¬¼ë¥˜ íƒ€ì´ë¨¸ v1.0.0 ìµœì¢… ì™„ì„±

âœ¨ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ í’ˆì§ˆ ë‹¬ì„±
ğŸ¯ SOLID ì›ì¹™ ì™„ì „ ì ìš©  
ğŸ”’ ê¸°ì¡´ ê¸°ëŠ¥ 100% ë³´ì¡´
ğŸš€ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

ê³µêµ° ì¢…í•©ë³´ê¸‰ì°½ ë””ì§€í„¸í˜ì‹  í”„ë¡œì íŠ¸ ì™„ì„± ğŸ‰"; then
        echo "âœ… ìµœì¢… íƒœê·¸ ìƒì„±: $final_tag"
        
        if git push origin "$final_tag"; then
            echo "âœ… ìµœì¢… íƒœê·¸ í‘¸ì‹œ ì„±ê³µ"
        else
            echo "âš ï¸ íƒœê·¸ í‘¸ì‹œ ì‹¤íŒ¨ (ë¡œì»¬ì—ëŠ” ìƒì„±ë¨)"
        fi
    fi
    
    echo ""
    echo "ğŸ‰ í”„ë¡œì íŠ¸ ì™„ì„± ë° ë°°í¬ ì„±ê³µ!"
    echo "=============================================="
    echo "âœ… ìµœì¢… ì™„ë£Œëœ ì‘ì—…ë“¤:"
    echo "  â€¢ ì›ê²© ì €ì¥ì†Œì™€ ë™ê¸°í™” ì™„ë£Œ"
    echo "  â€¢ ëª¨ë“  ë³€ê²½ì‚¬í•­ í†µí•© ì™„ë£Œ"
    echo "  â€¢ GitHub í‘¸ì‹œ ì„±ê³µ"
    echo "  â€¢ ìµœì¢… ë¦´ë¦¬ìŠ¤ íƒœê·¸ ìƒì„± ($final_tag)"
    echo ""
    echo "ğŸ”— í™•ì¸ ë§í¬:"
    echo "  â€¢ GitHub ë ˆí¬ì§€í† ë¦¬: https://github.com/JoBongGeun94/LogisticsTimer"
    echo "  â€¢ ìµœì‹  ì»¤ë°‹: https://github.com/JoBongGeun94/LogisticsTimer/commits/main"
    echo "  â€¢ ë°°í¬ ì‚¬ì´íŠ¸: https://logisticstimer.onrender.com"
    echo ""
    echo "ğŸ“Š í”„ë¡œì íŠ¸ í˜„í™©:"
    echo "  â€¢ ìƒíƒœ: âœ… ì™„ì „ ì™„ì„±"
    echo "  â€¢ í’ˆì§ˆ: âœ… ì—”í„°í”„ë¼ì´ì¦ˆê¸‰"
    echo "  â€¢ ë°°í¬: âœ… ì¤€ë¹„ ì™„ë£Œ"
    echo "  â€¢ ë¬¸ì„œ: âœ… ì™„ì„±"
    echo ""
    echo "ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„:"
    echo "  1. GitHubì—ì„œ ìµœì¢… ì»¤ë°‹ í™•ì¸"
    echo "  2. Render.com ìë™ ë°°í¬ ëŒ€ê¸° (5-10ë¶„)"
    echo "  3. https://logisticstimer.onrender.com ì—ì„œ ìµœì¢… í…ŒìŠ¤íŠ¸"
    echo "  4. ì‚¬ìš©ì ê°€ì´ë“œ ì—…ë°ì´íŠ¸"
    echo ""
    echo "ğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
    echo "   ëª¨ë“  ëª©í‘œê°€ ë‹¬ì„±ë˜ì—ˆìœ¼ë©° ë°°í¬ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
    echo "=============================================="
    
else
    echo "âŒ í‘¸ì‹œ ì‹¤íŒ¨ - ì¶”ê°€ í•´ê²° í•„ìš”"
    echo ""
    echo "ğŸ” ì¶”ê°€ ì§„ë‹¨:"
    echo "ğŸ“‹ í˜„ì¬ ìƒíƒœ:"
    git status
    echo ""
    echo "ğŸ“‹ ë¡œì»¬ê³¼ ì›ê²©ì˜ ì°¨ì´:"
    git log --oneline origin/main..main 2>/dev/null || echo "ì°¨ì´ì  í™•ì¸ ë¶ˆê°€"
    echo ""
    echo "ğŸ”§ ìˆ˜ë™ í•´ê²° ì˜µì…˜:"
    echo "1. Force push (ì£¼ì˜ í•„ìš”):"
    echo "   git push --force-with-lease origin main"
    echo ""
    echo "2. ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¡œ í‘¸ì‹œ:"
    echo "   git checkout -b feature/final-update"
    echo "   git push origin feature/final-update"
    echo ""
    echo "3. í˜„ì¬ ìƒíƒœ í™•ì¸ í›„ ìˆ˜ë™ í•´ê²°"
fi